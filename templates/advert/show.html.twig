{% extends 'base.html.twig' %}

{% block title %}Advert{% endblock %}

{% block body %}
    <h1>{{ advert.author.username }} is looking for</h1>

    {# annonce #}
    <div class="rounded border bg-light">
        <p>posted on {{ advert.publishDate|format_datetime(pattern: 'yy.MM.dd') }} ({{ timeAgo(advert.publishDate).text }})</p>

        <p>
            {% for tag in advert.tags %}
                <u>{{ tag.name }}</u> 
            {% endfor %}
        </p>

        <hr>
        
        <p>{{ advert.content }}</p>
    </div>

    {# commentaires #}
    <h3>Comments ({{ advert.comments|length }})</h3>

    <div>
        {% if not is_granted('ROLE_USER') %}
            <p>Sorry, you need to be loged in to see comments</p>
        {% else %}
            {% for comment in advert.comments %}
            
            {# diffÃ©rencier les messages admin #}
                {% if comment.answerTo is empty %}
                    <div id="{{ comment.id }}">
                        <div class="rounded border bg-light">
                            <p>{{ comment.author.username }}</p>
                            <p>{{ comment.content }}</p>
                        </div>

                        <button class="answerTo">ðŸª…</button>
                    </div>

                    {# rÃ©ponses #}
                    {# voir comment tabuler #}
                    <div id="a{{ comment.id }}">
                        {% for answer in comment.answers %}
                            <div id="{{ comment.id }}">
                                <div class="rounded border border-secondary bg-light">
                                    <p>{{ answer.author.username }}</p>
                                    <p>{{ answer.content }}</p>
                                </div>

                                <button class="answerTo">ðŸª…</button>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

            {% endfor %}
        {% endif %}
    </div>

    <h3>Leave a comment</h3>

    <div>
        {# nouveau commentaire#}
        {% include('advert/_new_comment.html.twig') %}
    </div>


    {# sÃ©paration trucs par dÃ©faut symfony #}
    <hr>

    <a href="{{ path('app_advert_index') }}">back to list</a>

    {# <a href="{{ path('app_advert_edit', {'id': advert.id}) }}">edit</a> #}

    {# {{ include('advert/_delete_form.html.twig') }} #}



    {# JS pour rÃ©ponse #}
    {% block customJS %}
        {{ encore_entry_script_tags('answerComment') }}
    {% endblock %}
    {# {% block customCSS %}
        {{ encore_entry_link_tags('') }}
    {% endblock %} #}
{% endblock %}
